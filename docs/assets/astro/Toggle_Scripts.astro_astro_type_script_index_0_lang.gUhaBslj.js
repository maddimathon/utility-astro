/*!
 * @maddimathon/utility-astro@0.1.0-alpha.9
 * @license MIT
 */class e{static abortNew(t){t&&t.setAttribute("data-toggle-container","")}static async init(t){window.addEventListener("load",()=>document.querySelectorAll("[data-toggle-container]").forEach(n=>n.id&&e.new(n,t)))}static async new(t,n){const s=t?.id;if(!t||!s)return e.abortNew(t),null;const r=document.querySelectorAll(`[data-toggle-primary-control=${s}], [data-toggle-control=${s}]`);if(!r.length)return e.abortNew(t),null;const o=document.querySelector(`[data-toggle-primary-control=${s}]`)??r[0],i=t.querySelector(`[data-toggle-content=${s}]`);return i?new e({container:t,primaryButton:o,allButtons:Array.from(r),content:i},n):(e.abortNew(t),null)}static openEvent=null;static closeEvent=null;static cssTimeToMilliseconds(t){return t.includes("ms")?Number(t.replace(/\s*ms\s*$/gi,"")):Number(t.replace(/\s*s\s*$/gi,""))*1e3}static createCustomEvents(){this.openEvent===null&&(this.openEvent=new Event("toggle-open")),this.closeEvent===null&&(this.closeEvent=new Event("toggle-close"))}opts;container;content;primaryButton;allButtons;containerID;closingTimeout=null;closingTime;constructor(t,n){if(this.opts={closeWhenUntargetted:!1,closingTime:1800,openWhenTargetted:!0,...n},this.closingTime=this.opts.closingTime,this.container=t.container,this.primaryButton=t.primaryButton,this.allButtons=t.allButtons,this.content=t.content,this.containerID=this.container.id,!this.container||!this.primaryButton||!this.containerID||!this.content){this.abortConstructor();return}this.toggle=this.toggle.bind(this),this.handleHashChange=this.handleHashChange.bind(this);const s=this.content.id;this.content.setAttribute("aria-labelledby",this.primaryButton.id),this.content.setAttribute("role","region"),s&&this.allButtons.forEach(i=>{(i.getAttribute("role")=="button"||i.tagName.toUpperCase()=="BUTTON"||i.tagName.toUpperCase()=="A")&&i.setAttribute("aria-controls",s)}),this.closingTime=e.cssTimeToMilliseconds(getComputedStyle(this.container).getPropertyValue("--toggle-closing-time"));const r=this.opts.openWhenTargetted&&this.checkUrlTarget(new URL(window.location.href)),o=this.container.getAttribute("data-toggle-container")==="open"||r;this.allButtons.forEach(i=>{i.addEventListener("click",this.toggle),i.getAttribute("aria-controls")&&(i.removeAttribute("aria-disabled"),i.setAttribute("aria-expanded",o?"true":"false"))}),o?r?this.openAsTargetAnchor():this.open():this.container.setAttribute("data-toggle-container","closed"),r||this.primaryButton.removeAttribute("data-toggle-is-current-target"),this.opts.openWhenTargetted&&window.addEventListener("hashchange",this.handleHashChange)}abortConstructor(){e.abortNew(this.container)}clearTimeout(){this.closingTimeout!==null&&clearTimeout(this.closingTimeout)}checkUrlTarget(t){return t.hash?t.hash.replace(/^#/gi,"").toLowerCase()===this.containerID.toLowerCase():!1}handleHashChange(t){if(!this.opts.openWhenTargetted)return;const n=this.checkUrlTarget(new URL(t.newURL));n||this.primaryButton.removeAttribute("data-toggle-is-current-target"),n&&this.openAsTargetAnchor(),!n&&this.opts.closeWhenUntargetted&&this.checkUrlTarget(new URL(t.oldURL))&&this.container.getAttribute("data-toggle-container")==="open"&&this.close()}openAsTargetAnchor(){this.open(),this.primaryButton.setAttribute("data-toggle-is-current-target","true"),this.primaryButton.addEventListener("blur",()=>this.primaryButton.removeAttribute("data-toggle-is-current-target"),{once:!0}),this.primaryButton.focus({focusVisible:!0})}toggle(){if(this.container)switch(this.container.getAttribute("data-toggle-container")){case"closed":this.clearTimeout(),this.open();break;case"closing":break;case"open":default:this.clearTimeout(),this.close();break}}open(){this.allButtons&&this.container&&(this.closingTime=e.cssTimeToMilliseconds(getComputedStyle(this.container).getPropertyValue("--toggle-closing-time")),this.container.setAttribute("data-toggle-container","open"),this.allButtons.forEach(t=>{t.getAttribute("aria-controls")&&t.setAttribute("aria-expanded","true")}),e.createCustomEvents(),this.container.dispatchEvent(e.openEvent))}close(){this.allButtons&&this.container&&(this.allButtons.forEach(t=>{t.getAttribute("aria-controls")&&t.setAttribute("aria-expanded","false")}),this.container.setAttribute("data-toggle-container","closing"),this.closingTimeout=setTimeout(()=>{this.container&&this.container.setAttribute("data-toggle-container","closed")},this.closingTime+50),e.createCustomEvents(),this.container.dispatchEvent(e.closeEvent))}}await e.init();
