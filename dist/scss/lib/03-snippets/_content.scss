///
/// @package @maddimathon/utility-astro@0.1.0-alpha.8
/// @since 0.1.0-alpha
///

// @use 'pkg:@maddimathon/utility-sass/03-snippets' as utils;

@use 'pkg:@maddimathon/utility-sass/list';
@use 'pkg:@maddimathon/utility-sass/selector';

@use '../../config';

@use '../01-functions' as *;
@use '../02-mixins' as *;

$_width_content: var-width(content);
$_width_sidebar: var-width(sidebar);

$_contentCol_default: minmax(auto, $_width_content);

///
/// @since 0.1.0-alpha
///
@function snippet-support-astro-content--default-grid-page() {
    // prettier-ignore
    @return 0 [page-start] 1fr [sidebar-start] 0 [content-start] #{$_contentCol_default} [content-end] 0 [sidebar-end] 1fr [page-end] 0;
}

$_default_grid_page: snippet-support-astro-content--default-grid-page();

///
/// Includes the bascis properties for a page layout grid (but no columns).
///
/// @since 0.1.0-alpha
///
@mixin snippet-support-astro-content--base-grid {
    --display: grid;
    display: grid;
    position: relative;

    justify-content: center;
    justify-items: stretch;
    align-content: start;
    align-items: start;

    grid-auto-rows: auto;
    grid-auto-flow: column;

    gap: 0;
}

///
/// @since 0.1.0-alpha
///
@mixin snippet-support-astro-content--content-width {
    grid-column: content-start / content-end;
    // width: 100%;
    width: auto;
    // max-width: #{var-width(content)};
}

///
/// @since 0.1.0-alpha
///
@mixin snippet-support-astro-content--page-width {
    grid-column: page-start / page-end;
    // width: 100%;
    width: auto;
    // max-width: #{var-width(page)};
}

///
/// @since 0.1.0-alpha
///
@mixin snippet-support-astro-content--sidebar-width {
    grid-column: sidebar-start / sidebar-end;
    // width: 100%;
    width: auto;
    // max-width: #{var-width(sidebar)};
}

///
/// @since 0.1.0-alpha
///
@mixin snippet-support-astro-content--site-width {
    grid-column: site-start / site-end;
    // width: 100%;
    width: auto;
    // max-width: #{var-width(site)};
}

///
/// @since 0.1.0-alpha
///
@mixin _body-grid--layout-content-only(
    $bodyMargin,
    $contentCol,
    $gutterHalfCol,
    $sidebarHalfCol
) {
    @include min-width(sidebar) {
        // prettier-ignore
        $_default_grid_page: 0 [page-start] #{$sidebarHalfCol} #{$gutterHalfCol} [sidebar-start] 0 [content-start] #{$contentCol} [content-end] 0 [sidebar-end] #{$gutterHalfCol} #{$sidebarHalfCol} [page-end] 0;

        /* prettier-ignore */
        --grid-template-columns--page: #{$_default_grid_page};

        /* prettier-ignore */
        grid-template-columns: #{$bodyMargin} [site-start] 1fr #{$_default_grid_page} 1fr [site-end] #{$bodyMargin};
    }
}

///
/// @since 0.1.0-alpha
///
@mixin _body-grid--layout-sidebar(
    $side,
    $bodyMargin,
    $contentCol,
    $gutterCol,
    $sidebarCol
) {
    $contentCol: [content-start] #{$contentCol} [content-end];
    $sidebarCol: [sidebar-start] #{$sidebarCol} [sidebar-end];

    $_firstColumn: $contentCol;
    $_secondColumn: $sidebarCol;

    @if $side == left {
        $_firstColumn: $sidebarCol;
        $_secondColumn: $contentCol;
    }

    @include min-width(sidebar) {
        // prettier-ignore
        $_default_grid_page: 0 [page-start] 0 #{$_firstColumn} #{$gutterCol} #{$_secondColumn} 0 [page-end] 0;

        /* prettier-ignore */
        --grid-template-columns--page: #{$_default_grid_page};

        /* prettier-ignore */
        grid-template-columns: #{$bodyMargin} [site-start] 1fr #{$_default_grid_page} 1fr [site-end] #{$bodyMargin};
    }
}

///
/// Supports the Content astro layout.
///
/// @since 0.1.0-alpha
///
@mixin snippet-support-astro-content {
    $bodyMargin: var-gap-inline(layout-half);

    $contentCol: $_contentCol_default;

    $gutterCol: var-gap-inline(layout);
    $gutterHalfCol: var-gap-inline(layout-half);

    $sidebarCol: minmax(auto, $_width_sidebar);
    $sidebarHalfCol: minmax(auto, calc($_width_sidebar / 2));

    @at-root {
        ///
        /// WIDTH UTILITIES
        /// for internal use
        ///
        %_site-width {
            @include snippet-support-astro-content--site-width;
        }
        %_page-width {
            @include snippet-support-astro-content--page-width;
        }
        %_content-width {
            @include snippet-support-astro-content--content-width;
        }
        %_sidebar-width {
            @include snippet-support-astro-content--sidebar-width;
        }

        ///
        /// WIDTH UTILITIES
        /// for external use and nesting
        ///
        %site-width {
            @include snippet-support-astro-content--site-width;
        }
        %page-width {
            @include snippet-support-astro-content--page-width;
        }
        %content-width {
            @include snippet-support-astro-content--content-width;
        }
        %sidebar-width {
            @include snippet-support-astro-content--sidebar-width;
        }

        ///
        /// BASE BODY GRID
        ///

        %_body-grid,
        %_body-subgrid {
            @include snippet-support-astro-content--base-grid;

            /* prettier-ignore */
            --grid-template-columns--page: #{$_default_grid_page};

            /* prettier-ignore */
            grid-template-columns: #{$bodyMargin} [site-start] #{$_default_grid_page} [site-end] #{$bodyMargin};

            margin-inline: 0;
            // padding-inline: #{$bodyMargin};

            /// BLOCK ///

            @at-root :where(#{selector.nest( &, '> *' )}) {
                @include snippet-support-astro-content--content-width;
            }
        }

        %_body-grid {
            @include _body-grid--layout-content-only(
                $bodyMargin: $bodyMargin,
                $contentCol: $contentCol,
                $gutterHalfCol: $gutterHalfCol,
                $sidebarHalfCol: $sidebarHalfCol
            );
        }

        %html {
            display: block;
            position: relative;
        }

        %body {
            @extend %_body-grid;
            margin: 0;
            padding: 0;
            z-index: 1;

            /// BLOCK ///

            @at-root :where(#{selector.nest( &, '> *', '+ *' )}) {
                margin-block: #{var-gap-block(layout)} 0;
            }

            > header,
            > footer,
            > main,
            > nav,
            > %body-subgrid {
                @extend %_body-subgrid;
                grid-column: 1 / -1;

                grid-template-columns: subgrid;

                margin-inline: 0;
            }

            %pre {
                width: min(120ch, 100%);

                > %code {
                }
            }

            %table {
            }

            > header,
            > footer,
            > nav {
                /// BLOCK ///

                @at-root :where(#{selector.nest( &, '> *' )}) {
                    @include snippet-support-astro-content--page-width;
                }
            }
            > header {
            }
            > footer {
                margin-block: #{var-gap-block(layout)};
            }
            > nav {
            }

            > main {
            }

            > aside {
                @extend %_sidebar-width;

                > :first-child {
                    margin-block-start: 0;
                }
            }
        }

        :where(%body > %callout-width),
        :where(%body > %blockquote),
        :where(%body > %form) {
            margin-inline: 0;
            width: auto;
            max-width: none;
            justify-self: start;
        }

        :where(%body > %button) {
            width: auto;
            justify-self: start;
        }

        ///
        /// LAYOUTS
        ///

        %layout-content-only {
        }

        %layout-full-width,
        %layout-extra-wide {
        }

        %layout-full-width {
            > main {
                /// BLOCK ///

                @at-root :where(#{selector.nest( &, '> *' )}) {
                    @include snippet-support-astro-content--page-width;
                }
            }
        }

        %layout-extra-wide {
            > main {
                /// BLOCK ///

                @at-root :where(#{selector.nest( &, '> *' )}) {
                    @include snippet-support-astro-content--site-width;
                }
            }
        }

        %layout-sidebar-left,
        %layout-sidebar-right {
            @include min-width(sidebar) {
                > main {
                    // prettier-ignore
                    $_default_grid_page: 0 [page-start] 0 [sidebar-start] 0 [content-start] 1fr [content-end] 0 [sidebar-end] 0 [page-end] 0;

                    /* prettier-ignore */
                    --grid-template-columns--page: #{$_default_grid_page};

                    /* prettier-ignore */
                    grid-template-columns: 0 [site-start] #{$_default_grid_page} [site-end] 0;
                    grid-template-columns: subgrid;

                    &,
                    & %page-width {
                        @include snippet-support-astro-content--content-width;
                    }

                    /// BLOCK ///

                    @at-root :where(#{selector.nest( &, '> *' )}) {
                        @include snippet-support-astro-content--content-width;
                    }
                }
            }
        }

        %layout-sidebar-left {
            @include _body-grid--layout-sidebar(
                left,
                $bodyMargin: $bodyMargin,
                $contentCol: $contentCol,
                $gutterCol: $gutterCol,
                $sidebarCol: $sidebarCol
            );
        }

        %layout-sidebar-right {
            @include _body-grid--layout-sidebar(
                right,
                $bodyMargin: $bodyMargin,
                $contentCol: $contentCol,
                $gutterCol: $gutterCol,
                $sidebarCol: $sidebarCol
            );
        }
    }
}
