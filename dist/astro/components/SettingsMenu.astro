---
/**
 * @since 0.1.0-alpha.draft
 *
 * @packageDocumentation
 */

/* import - types */
import type { GenericElementProps } from '../../ts/00-types/index.js';
import type { Props as SettingsMenuProps } from './SettingsMenu.d.ts';

/* import - functions */
import { absoluteInternalURL } from '../functions/index.js';
import SettingsMenu_Scripts from '../support/SettingsMenu_Scripts.astro';

/* import - values */

/* import - components */

/* import - layouts */

/* TYPES ===================================== */

export type * from './SettingsMenu.d.ts';

/* PROPS ===================================== */

export type Props = GenericElementProps<SettingsMenuProps, 'div'>;

const {
    accessibilityReportEmail,

    class: classList = ['website-settings-menu'],
    id = 'website-settings',

    privacyPolicy: privacyPolicyURL,
    settings: inputSettings,

    scripts = true,

    ...attributes
}: Props = Astro.props.frontmatter ?? Astro.props;

/* FUNCTIONS ===================================== */

function optionHTML(
    name: string,
    label: string,
    value: string,
    labelClass: string = ''
): string {
    const id = `${name}-${value}`;

    return `<label for="${id}" class="${labelClass}"><input
        name="${name}"
        id="${id}"
        value="${value}"
        type="radio"
        data-settings-input
    />${label}</label>`;
}

/* CONSTANTS ===================================== */

const buttonID = `${id}-button`;

const accessEmailSubject =
    'Accessibility Issue — ' +
    absoluteInternalURL(Astro.url, Astro.url.pathname, false).replace(
        /^https?:\/\/(www\.)?/gi,
        ''
    );

const settings: Required<Required<SettingsMenuProps>['settings']> = {
    brightness: true,
    contrast: false,
    motion: false,

    ...inputSettings,
};
---

<div
    id={id}
    class:list={classList}
    aria-label='Accessibility & Display Settings'
    {...attributes}
    role='region'
    data-settings-menu
    data-settings-path={absoluteInternalURL(Astro.url, '')}
    data-toggle-container
>
    <slot />

    <button
        id={buttonID}
        class='website-settings__toggle'
        role='button'
        aria-label='Toggle settings menu'
        title='Accessibility & Display Settings'
        data-toggle-control={id}
    >
        <span class='icon | settings-icon'>
            <svg
                xmlns='http://www.w3.org/2000/svg'
                width='24'
                height='24'
                viewBox='0 0 24 24'
                fill='none'
                stroke='currentColor'
                stroke-width='2'
                stroke-linecap='round'
                stroke-linejoin='round'
                class='icon-cog'
                role='img'
                aria-hidden='true'
            >
                <path d='M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z'></path>
                <path d='M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z'></path>
                <path d='M12 2v2'></path>
                <path d='M12 22v-2'></path>
                <path d='m17 20.66-1-1.73'></path>
                <path d='M11 10.27 7 3.34'></path>
                <path d='m20.66 17-1.73-1'></path>
                <path d='m3.34 7 1.73 1'></path>
                <path d='M14 12h8'></path>
                <path d='M2 12h2'></path>
                <path d='m20.66 7-1.73 1'></path>
                <path d='m3.34 17 1.73-1'></path>
                <path d='m17 3.34-1 1.73'></path>
                <path d='m11 13.73-4 6.93'></path>
            </svg>
        </span>
    </button>

    <form
        action=''
        class='website-settings__content'
        data-toggle-content={id}
    >
        <div class='container'>
            <!-- SLOT: "settings-menu-open" -->
            <slot name='settings-menu-open' />
            <!-- /SLOT: "settings-menu-open" -->

            {
                accessibilityReportEmail && (
                    <p class='website-settings__report'>
                        <a
                            href={`mailto:${accessibilityReportEmail}?subject=${encodeURIComponent(accessEmailSubject)}`}
                        >
                            Report Accessibility Issue
                        </a>
                    </p>
                )
            }

            {
                settings.brightness && (
                    <fieldset>
                        <legend>Brightness Mode</legend>

                        <div class='container'>
                            <Fragment
                                set:html={optionHTML(
                                    'brightness-mode',
                                    'Light',
                                    'light'
                                )}
                            />
                            <Fragment
                                set:html={optionHTML(
                                    'brightness-mode',
                                    'Dark',
                                    'dark'
                                )}
                            />
                        </div>
                    </fieldset>
                )
            }

            {
                settings.contrast && (
                    <fieldset>
                        <legend>Contrast Mode</legend>

                        <div class='container'>
                            <Fragment
                                set:html={optionHTML(
                                    'contrast-mode',
                                    'Low',
                                    'low'
                                )}
                            />
                            <Fragment
                                set:html={optionHTML(
                                    'contrast-mode',
                                    'Average',
                                    'average'
                                )}
                            />
                            <Fragment
                                set:html={optionHTML(
                                    'contrast-mode',
                                    'High',
                                    'high'
                                )}
                            />
                        </div>

                        <p class='forced-colors-mode-only aside'>
                            Your browser or computer has ‘forced colours’ mode
                            enabled, so changing the contrast setting will have
                            little impact (if any).
                        </p>
                    </fieldset>
                )
            }

            {
                settings.motion && (
                    <fieldset>
                        <legend>Motion/Animation</legend>

                        <div class='container'>
                            <Fragment
                                set:html={optionHTML(
                                    'motion',
                                    'Default',
                                    'no-preference'
                                )}
                            />
                            <Fragment
                                set:html={optionHTML(
                                    'motion',
                                    'Reduce',
                                    'reduce'
                                )}
                            />
                        </div>
                    </fieldset>
                )
            }

            <input
                type='reset'
                data-settings-reset
                value='Reset Settings'
            />

            <!-- SLOT: "settings-menu-close" -->
            <slot name='settings-menu-close' />
            <!-- /SLOT: "settings-menu-close" -->
        </div>
    </form>

    <div
        data-toggle-control={id}
        class='website-settings__backdrop'
        aria-hidden='true'
    >
    </div>
</div>

{scripts && <SettingsMenu_Scripts {...(scripts === true ? {} : scripts)} />}
