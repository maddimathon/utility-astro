---
/**
 * @since 0.1.0-alpha
 *
 * @packageDocumentation
 */

/* import - types */
import type { GenericElementProps } from '../../ts/00-types/index.js';

/* import - functions */

/* import - values */

/* import - components */

/* import - layouts */

/* TYPES ===================================== */

/* PROPS ===================================== */

/**
 * Input props for the Heading component.
 *
 * @since 0.1.0-alpha
 */
export interface HeadingProps {
    /**
     * Logical heading order value for this heading.
     */
    heading: number;

    /**
     * If any, the heading display level override for this heading (otherwise
     * the `heading` value is used).  If false, a 'unstyled-heading' utility
     * class is adding to the heading.
     *
     * @since 0.1.0-alpha.7 â€” Added false and undefined options.
     */
    displayHeading?: number | false | undefined;

    /**
     * The minimum allowed value for this heading.
     */
    minimum?: number;
}

export interface Props extends GenericElementProps<HeadingProps, 'div'> {}

const {
    class: classList = [],
    displayHeading: displayHeadingRaw,
    heading: headingRaw,
    minimum = 2,
    ...attributes
}: Props = Astro.props.frontmatter ?? Astro.props;

/* CONSTANTS ===================================== */

const htmlContent = (await Astro.slots.render('default')) || false;

/** is definitely an integer greater than 0 (0 defaults to 7) */
const heading = Math.round(Number(headingRaw)) || 7;

/** is definitely an integer greater than 0 (0 defaults to undefined) */
const displayHeading =
    displayHeadingRaw && (Math.round(Number(displayHeadingRaw)) || undefined);

const Tag =
    heading >= minimum && heading < 7
        ? (`h${heading as 2 | 3 | 4 | 5 | 6}` as const)
        : ('p' as const);
---

{
    htmlContent &&
        (displayHeading === false ? (
            <p
                {...attributes}
                aria-level={heading > 1 ? heading : undefined}
                class:list={['unstyled-heading ||', classList]}
                role={heading > 1 ? 'heading' : undefined}
                set:html={htmlContent}
            />
        ) : Tag !== 'p' ? (
            <Tag
                {...attributes}
                class:list={[
                    displayHeading && `h${displayHeading} ||`,
                    classList,
                ]}
                set:html={htmlContent}
            />
        ) : (
            <p
                {...attributes}
                aria-level={heading > 1 ? heading : undefined}
                class:list={[
                    displayHeading ? `h${displayHeading}` : `h${heading}`,
                    '||',
                    classList,
                ]}
                role={heading > 1 ? 'heading' : undefined}
                set:html={htmlContent}
            />
        ))
}
